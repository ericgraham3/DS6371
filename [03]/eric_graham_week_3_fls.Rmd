---
title: "Week 3 FLS"
author: "Eric Graham"
date: "2024-09-09"
output: 
  powerpoint_presentation:
    slide_level: 2
    reference_doc: presentation.pptx
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, results = "hide")
library(dplyr)
library(ggplot2)
library(ggthemes)
library(scales)
```

# Question 1: Quick Quiz Questions

# Question 2: Reaction Time Experiment

```{r}
# read in data
twitch = read.csv("twitch.csv", header = TRUE)
head(twitch)
summary(twitch)

# calculate critical values
df = nrow(twitch) - 1
qt(.975, df)

# paired t-test
t.test(x = twitch$Ritalin, y = twitch$Placebo, paired = TRUE)
```

## Step 1: Problem Statement / Identify H~0~ and H~a~

In an effort to test the effect of the drug Ritalin on reflexes, an experiment was conducted in which 41 participants were subjected to a periodic blast of sound via headphones and the speed with which their eyes twitched in response to that sound were measured. The participants were recruited via newspaper ad and paid for their participation. The participants each came to the research site twice: on one visit they received a Ritalin treatment, and on the other they received a placebo. Neither participant nor researchers knew whether they were in the Ritalin or placebo group on a given visit.

---

To test whether Ritalin has any effect on the twitch time of the study participants, we will use a paired t-test. This mitigates the lack of independence in our sample and allows us to compare the mean difference between the Ritalin reactions and the placebo reaction. Since the observed data showed a mean difference of 0.09447, our null hypothesis will assume no difference, and the t-test will test the alternative hypothesis, that there is a difference between the means of the two groups. 

#### H~0~: $$\mu_{\text{Ritalin}} - \mu_{\text{Placebo}} = 0$$

#### H~a~: $$\mu_{\text{Ritalin}} - \mu_{\text{Placebo}} \neq 0$$

## Step 2: Find the Critical Values and Draw and Shade

I was able to calculate our critical value using R, which found it to be 2.021. This means that to meet the threshold of statistical significance our test statistic would need to be more extreme than +/- 2.021 (which would be located in the shaded region below).

![Critical values for 95% confidence level with 40 degrees of freedom](twitch-critical-values.png)

## Step 3: Find the Test Statistic

Using a paired t-test in R, we find the test statistic to be 3.3565, which we can see is well within the shaded region to the right of our critical value.

![Test statistic for paired t-test](twitch-t-stat.png)

## Step 4: Find the P-Value

R calculated the p-value for our sample, which is 0.00174. This means that there is a 0.174% chance of observing, by random chance, a result as extreme or more extreme than the observed mean difference.

![P-value for paired t-test](twitch-p-value.png)

## Step 5: Reject or Fail to Reject H~0~

Given that our desired confidence level is 95%, we would need to see a p-value less than (or equal to) .05 to reject the null hypothesis. Our p-value (0.00174) is well below that threshold, so we reject the null hypothesis.

## Step 6: Statistical Conclusion and Scope of Inference

There is strong evidence to suggest that there is a difference in reaction time between the Ritalin and Placebo groups, with a p-value of 0.00174. We are 95% confident that the mean difference in reaction times between the Placebo group and Ritalin group is between 0.03758528 and 0.15135473.

Because the test subjects were randomly allocated to the treatment group (in a double blind experiment) we can say that the evidence suggests a causal effect of the Ritalin treatment in decreasing reaction time. 

However, these findings are limited to the sample participants. We can't make inferences to the population because these subjects were recruited via a newspaper ad and compensated for their participation. The sample wasn't randomly chosen, so we can't make inferences to the population based on the experiment. The strong treatment effect demonstrated does indicate that further experiments, with truly randomized samples, might be useful avenues for research.

# Question 3: Education and Income

```{r}
education = read.csv("EducationData.csv", header = TRUE)
summary(education)
```

The summary of the data, and following histograms, show that the distributions of the two samples are not normal (they are both right-skewed), and the samples have substantially different standard deviations and sample sizes. Thus, an ordinary t-test would not be valid.    

```{r, echo = TRUE, results = "markup"}
education %>% group_by(Educ) %>% summarize(mean_income = mean(Income2005), sd_income = sd(Income2005), count = n())
```

---

```{r}
education %>% ggplot(aes(x = Income2005)) +
  geom_histogram(color = "blue") +
  facet_wrap(~Educ) +
  theme_economist() +
  scale_x_continuous(labels = scales::comma) +
  labs(
    title = "Income Distribution by Education Level",
    x = "Income",
    y = "Education Level"
  )
```

---

A logarithmic transformation can be used to create a more normal distribution upon which to run our t-test. The below summary and following histograms show the effect of this transformation. The summary of the data, and the following histograms, show the two sample distributions to be much less skewed, and much closer in spread.

```{r, echo = TRUE, results = "markup"}
# logarithmic transformation on income
education_log = education %>% mutate(log_income = log(Income2005))
head(education_log)
education_log %>% group_by(Educ) %>% summarize(mean_income = mean(log_income), sd_income = sd(log_income), count = n())
```

---

```{r}
education_log %>% ggplot(aes(x = log_income)) +
  geom_histogram(color = "blue") +
  facet_wrap(~Educ) +
  theme_economist() +
  scale_x_continuous(labels = scales::comma) +
  labs(
    title = "Log-Adjusted Income Distribution by Education Level",
    x = "Income",
    y = "Education Level"
  )
```


---

The pooled t-test on the log-transformed results shows a p-value of 2.2e-16 (0.00000000000000022), which is very strong evidence to reject the null hypothesis that there is no difference in mean income between those who completed either 12 or 16 years of education.

```{r, echo = TRUE, results = "markup"}
# pooled t-test stored as variable so we can extract and exponentiate the reported values from the confidence interval
log_test_result = t.test(log_income ~ Educ, data = education_log, var.equal = TRUE)
log_test_result
```

---

By reversing the log-transformation that we performed on the original income data, we can accurately report a confidence interval for the expected difference in income. 

```{r, echo = TRUE, results = "markup"}
# extracting lower and upper bounds from confidence interval and exponentiating them
str(log_test_result)
lower_bound = log_test_result$conf.int[1]
upper_bound = log_test_result$conf.int[2]
reported_lower_bound = exp(lower_bound)
reported_upper_bound = exp(upper_bound)
reported_lower_bound
reported_upper_bound
```

For distributions which violate so many of the standard t-tests assumptions, Welch's t-test can also be used.

```{r, echo = TRUE, results = "markup"}
t.test(Income2005 ~ Educ, data = education, var.equal = FALSE)
```